{"mappings":"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","sources":["example/main.ts","lib/index.ts","lib/credentials.ts","node_modules/@parcel/transformer-js/src/esmodule-helpers.js","lib/network.ts","node_modules/eventemitter3/index.js","lib/signaling.ts","lib/peer.ts","lib/latency.ts"],"sourcesContent":["import { Network } from '../lib'\n\nconst n = new Network('d0fe1ca1-7fa0-47ed-9469-6c792f68bae0')\n;(window as any).n = n\n\nconst inp = document.getElementById('input') as HTMLInputElement\nconst out = document.getElementById('output') as HTMLTextAreaElement\nconst log = (text: string): void => {\n  console.log(text)\n  if (out?.innerText != null) {\n    const time = (new Date()).toLocaleTimeString()\n    out.value += `[${time}] ${text.trim()}\\n`\n    out.scrollTop = out.scrollHeight\n  }\n}\n\nn.on('ready', () => {\n  log('network ready')\n\n  n.on('message', (peer, channel, data) => {\n    if (channel === 'reliable') {\n      log(`${peer.id} said \"${data as string}\" via ${channel}`)\n    }\n  })\n  inp.addEventListener('keyup', e => {\n    if (e.key === 'Enter') {\n      log(`sending ${inp.value}`)\n      n.broadcast('reliable', inp.value)\n      inp.value = ''\n    }\n  })\n\n  document.querySelector('a[data-action=\"create\"]')?.addEventListener('click', () => {\n    if (n.currentLobby === undefined) {\n      void n.create({ codeFormat: 'short', public: true })\n    }\n  })\n\n  document.querySelector('a[data-action=\"join\"]')?.addEventListener('click', () => {\n    if (n.currentLobby === undefined) {\n      const code = prompt('Lobby code? (empty to create a new one)')\n      if (code != null && code !== '') {\n        void n.join(code)\n      }\n    }\n  })\n\n  const queryLobbies = (): void => {\n    console.log('querying lobbies...')\n    void n.list().then(lobbies => {\n      console.log('queried lobbies:', lobbies)\n      const el = document.getElementById('lobbies')\n      if (el !== null) {\n        el.innerHTML = ''\n        if (lobbies === null || lobbies.length === 0) {\n          const li = document.createElement('li')\n          li.innerHTML = '<i>no lobbies</i>'\n          el.appendChild(li)\n        } else {\n          lobbies.forEach(lobby => {\n            const li = document.createElement('li')\n            li.id = lobby.code\n            li.innerHTML = `<a href=\"javascript:void(0)\" class=\"code\">${lobby.code}</a> - <span class=\"players\">${lobby.playerCount}</span> players`\n            el.appendChild(li)\n            if (n.currentLobby === undefined) {\n              li.querySelector('a.code')?.addEventListener('click', () => {\n                void n.join(lobby.code)\n              })\n            }\n          })\n        }\n      }\n    })\n  }\n  queryLobbies()\n  setInterval(queryLobbies, 5000)\n})\n\nn.on('lobby', code => {\n  log(`lobby code ready: ${code} (and you are ${n.id})`)\n\n  const li = document.createElement('li')\n  li.id = n.id\n  li.innerHTML = `${n.id} <span>me${n.id === n.currentLobbyLeader ? ', leader' : ''}</span> (ping: <span>0</span>)`\n  document.getElementById('peers')?.appendChild(li)\n})\n\nn.on('signalingerror', console.error.bind(console.error))\nn.on('rtcerror', console.error.bind(console.error))\n\nn.on('connecting', peer => { log(`peer connecting ${peer.id}`) })\nn.on('disconnected', peer => {\n  log(`peer disconnected ${peer.id} (${n.size} peers now)`)\n  document.getElementById(peer.id)?.remove()\n})\n\nn.on('connected', peer => {\n  (window as any).peer = peer\n\n  log(`peer connected: ${peer.id} (${n.size} peers now)`)\n  n.broadcast('reliable', `got new peer! ${peer.id}`)\n\n  const li = document.createElement('li')\n  li.id = peer.id\n  li.innerHTML = `${peer.id} <span>${peer.id === n.currentLobbyLeader ? 'leader' : ''}</span> (ping: <span>0</span>)`\n  document.getElementById('peers')?.appendChild(li)\n\n  setInterval(() => {\n    (li.querySelector('span:nth-child(2)') as Element).innerHTML = `${peer.latency.average.toFixed(1)}ms ${peer.latency.jitter.toFixed(1)}ms`\n    n.send('unreliable', peer.id, 'bogus data')\n  }, 16)\n})\n\nn.on('leader', () => {\n  document.querySelectorAll('#peers li span').forEach((el: Element) => {\n    const id = el.parentElement?.id\n    const parts = []\n    if (id === n.id) {\n      parts.push('me')\n    }\n    if (el.parentElement?.id === n.currentLobbyLeader) {\n      parts.push('leader')\n    }\n    el.innerHTML = parts.join(', ')\n  })\n})\n","import { PokiTurnMatch } from './credentials'\nimport { PeerConfiguration } from './types'\n\nexport const DefaultSignalingURL = process.env.NODE_ENV === 'production' ? 'wss://netlib.poki.io/v0/signaling' : 'ws://localhost:8080/v0/signaling'\n\nexport const DefaultRTCConfiguration: PeerConfiguration = {\n  iceServers: [\n    {\n      urls: [\n        'stun:stun.l.google.com:19302'\n      ]\n    },\n    {\n      urls: PokiTurnMatch\n    }\n  ]\n}\n\nexport const DefaultDataChannels: {[label: string]: RTCDataChannelInit} = {\n  reliable: {\n    ordered: true\n  },\n  unreliable: {\n    ordered: true,\n    maxRetransmits: 0\n  },\n  control: {\n    ordered: false\n  }\n}\n\nexport { default as Network } from './network'\n","import Signaling from './signaling'\nimport { CredentialsPacket, PeerConfiguration } from './types'\n\nconst FetchTimeout = 5000\nexport const PokiTurnMatch = 'turn:turn.rtc.poki.com'\n\nexport default class Credentials {\n  private cachedCredentials?: CredentialsPacket\n  private cachedCredentialsExpireAt: number = 0\n\n  private runningPromise?: Promise<CredentialsPacket>\n\n  constructor (public signaling: Signaling) {\n  }\n\n  async fillCredentials (config: PeerConfiguration): Promise<RTCConfiguration> {\n    const cloned = JSON.parse(JSON.stringify(config)) as PeerConfiguration\n\n    if (process.env.NODE_ENV === 'test') {\n      return cloned\n    }\n\n    if (config.testproxyURL !== undefined) {\n      return cloned\n    }\n\n    const hasPokiTurn = cloned.iceServers?.some(s => s.urls === PokiTurnMatch || s.urls.includes(PokiTurnMatch)) ?? false\n    if (!hasPokiTurn || cloned.iceServers === undefined) {\n      return cloned\n    }\n    if (this.runningPromise === undefined) {\n      this.runningPromise = new Promise<CredentialsPacket>((resolve) => {\n        if (this.cachedCredentials != null && this.cachedCredentialsExpireAt > performance.now()) {\n          resolve(this.cachedCredentials)\n          return\n        }\n        void this.signaling.request({\n          type: 'credentials'\n        }).then(credentials => {\n          if (credentials.type === 'credentials') {\n            this.cachedCredentials = credentials\n            this.cachedCredentialsExpireAt = performance.now() + (((credentials.lifetime ?? 0) - 60) * 1000)\n            resolve(credentials)\n          }\n        }).catch(() => {\n          resolve({ type: 'credentials' })\n          this.cachedCredentials = { type: 'credentials' }\n          this.cachedCredentialsExpireAt = performance.now() + FetchTimeout\n        })\n        setTimeout(() => {\n          resolve({ type: 'credentials' })\n          this.cachedCredentials = { type: 'credentials' }\n          this.cachedCredentialsExpireAt = performance.now() + FetchTimeout\n        }, FetchTimeout)\n      })\n    }\n    const credentials = await this.runningPromise\n    this.runningPromise = undefined\n\n    if (credentials.url === undefined) {\n      return cloned\n    }\n\n    cloned.iceServers.forEach(s => {\n      if (s.urls === PokiTurnMatch || s.urls.includes(PokiTurnMatch)) {\n        s.urls = credentials.url ?? ''\n        s.username = credentials.username\n        s.credential = credentials.credential\n      }\n    })\n    return cloned\n  }\n}\n","exports.interopDefault = function (a) {\n  return a && a.__esModule ? a : {default: a};\n};\n\nexports.defineInteropFlag = function (a) {\n  Object.defineProperty(a, '__esModule', {value: true});\n};\n\nexports.exportAll = function (source, dest) {\n  Object.keys(source).forEach(function (key) {\n    if (key === 'default' || key === '__esModule' || dest.hasOwnProperty(key)) {\n      return;\n    }\n\n    Object.defineProperty(dest, key, {\n      enumerable: true,\n      get: function () {\n        return source[key];\n      },\n    });\n  });\n\n  return dest;\n};\n\nexports.export = function (dest, destName, get) {\n  Object.defineProperty(dest, destName, {\n    enumerable: true,\n    get: get,\n  });\n};\n","import { EventEmitter } from 'eventemitter3'\n\nimport { DefaultDataChannels, DefaultRTCConfiguration, DefaultSignalingURL } from '.'\nimport { LobbyListEntry, LobbySettings, PeerConfiguration } from './types'\nimport Signaling, { SignalingError } from './signaling'\nimport Peer from './peer'\nimport Credentials from './credentials'\n\ninterface NetworkListeners {\n  ready: () => void | Promise<void>\n  lobby: (code: string, leader: string | undefined) => void | Promise<void>\n  connecting: (peer: Peer) => void | Promise<void>\n  connected: (peer: Peer) => void | Promise<void>\n  reconnecting: (peer: Peer) => void | Promise<void>\n  reconnected: (peer: Peer) => void | Promise<void>\n  disconnected: (peer: Peer) => void | Promise<void>\n  signalingreconnected: () => void | Promise<void>\n  failed: () => void | Promise<void>\n  message: (peer: Peer, channel: string, data: string | Blob | ArrayBuffer | ArrayBufferView) => void | Promise<void>\n  close: (reason?: string) => void | Promise<void>\n  rtcerror: (e: Event) => void | Promise<void> // TODO: Figure out how to make this e type be RTCErrorEvent\n  signalingerror: (e: SignalingError) => void | Promise<void>\n  leader: (id: string) => void | Promise<void>\n}\n\nexport default class Network extends EventEmitter<NetworkListeners> {\n  private _closing: boolean = false\n  public readonly peers: Map<string, Peer>\n  private readonly signaling: Signaling\n  private readonly credentials: Credentials\n  public dataChannels: {[label: string]: RTCDataChannelInit} = DefaultDataChannels\n\n  public log: (...data: any[]) => void = (...args: any[]) => {} // console.log\n\n  private readonly unloadListener: () => void\n\n  constructor (public readonly gameID: string, private readonly rtcConfig: PeerConfiguration = DefaultRTCConfiguration, signalingURL: string = DefaultSignalingURL) {\n    super()\n    this.peers = new Map<string, Peer>()\n    this.signaling = new Signaling(this, this.peers, signalingURL)\n    this.credentials = new Credentials(this.signaling)\n\n    this.unloadListener = () => this.close()\n    if (typeof window !== 'undefined') {\n      window.addEventListener('unload', this.unloadListener)\n    }\n  }\n\n  async list (filter?: string): Promise<LobbyListEntry[]> {\n    if (this._closing || this.signaling.receivedID === undefined) {\n      return []\n    }\n    const reply = await this.signaling.request({\n      type: 'list',\n      filter\n    })\n    if (reply.type === 'lobbies') {\n      return reply.lobbies\n    }\n    return []\n  }\n\n  async create (settings?: LobbySettings): Promise<string> {\n    if (this._closing || this.signaling.receivedID === undefined) {\n      return ''\n    }\n    const reply = await this.signaling.request({\n      type: 'create',\n      ...settings\n    })\n    if (reply.type === 'joined') {\n      return reply.lobby\n    }\n    return ''\n  }\n\n  async join (lobby: string): Promise<void> {\n    if (this._closing || this.signaling.receivedID === undefined) {\n      return\n    }\n    await this.signaling.request({\n      type: 'join',\n      lobby\n    })\n  }\n\n  async setCustomData (customData: {[key: string]: any}): Promise<true | string> {\n    if (this._closing || this.signaling.receivedID === undefined) {\n      return 'network is closing or not connected'\n    }\n    if (this.signaling.receivedID !== this.signaling.currentLobbyLeader) {\n      return 'only the lobby leader can update custom data'\n    }\n    const reply = await this.signaling.request({\n      type: 'update',\n      customData\n    })\n    if (reply.type === 'updated') {\n      if (reply.error === undefined) {\n        return true\n      }\n      return reply.error\n    }\n    return ''\n  }\n\n  close (reason?: string): void {\n    if (this._closing || this.signaling.receivedID === undefined) {\n      return\n    }\n    this._closing = true\n    this.emit('close', reason)\n\n    if (this.id !== '') {\n      this.signaling.send({\n        type: 'close',\n        id: this.id,\n        reason: reason ?? 'normal closure'\n      })\n    }\n\n    this.peers.forEach(peer => peer.close(reason))\n    this.signaling.close()\n\n    if (typeof window !== 'undefined') {\n      window.removeEventListener('unload', this.unloadListener)\n    }\n  }\n\n  send (channel: string, peerID: string, data: string | Blob | ArrayBuffer | ArrayBufferView): void {\n    if (!(channel in this.dataChannels)) {\n      throw new Error('unknown channel ' + channel)\n    }\n    if (this.peers.has(peerID)) {\n      this.peers.get(peerID)?.send(channel, data)\n    }\n  }\n\n  broadcast (channel: string, data: string | Blob | ArrayBuffer | ArrayBufferView): void {\n    if (!(channel in this.dataChannels)) {\n      throw new Error('unknown channel ' + channel)\n    }\n    this.peers.forEach(peer => peer.send(channel, data))\n  }\n\n  /**\n   * @internal\n   */\n  async _addPeer (id: string, polite: boolean): Promise<void> {\n    const config = await this.credentials.fillCredentials(this.rtcConfig)\n\n    config.iceServers = config.iceServers?.filter(server => !(server.urls.includes('turn:') && server.username === undefined))\n\n    const peer = new Peer(this, this.signaling, id, config, polite)\n    this.peers.set(id, peer)\n  }\n\n  /**\n   * @internal\n   */\n  _removePeer (peer: Peer): boolean {\n    return this.peers.delete(peer.id)\n  }\n\n  /**\n   * @internal\n   */\n  _prefetchTURNCredentials (): void {\n    this.credentials.fillCredentials(this.rtcConfig).catch(() => {})\n  }\n\n  /**\n   * @internal\n   */\n  _onSignalingError (e: SignalingError): void {\n    this.emit('signalingerror', e)\n    if (this.listenerCount('signalingerror') === 0) {\n      console.error('signallingerror not handled:', e)\n    }\n    void this.signaling.event('signaling', 'error', { error: JSON.stringify(e) })\n  }\n\n  /**\n   * @internal\n   */\n  _forceReconnectSignaling (): void {\n    this.signaling.close()\n  }\n\n  get id (): string {\n    return this.signaling.receivedID ?? ''\n  }\n\n  get closing (): boolean {\n    return this._closing\n  }\n\n  get size (): number {\n    return this.peers.size\n  }\n\n  get currentLobby (): string | undefined {\n    return this.signaling.currentLobby\n  }\n\n  get currentLobbyLeader (): string | undefined {\n    return this.signaling.currentLobbyLeader\n  }\n}\n","'use strict';\n\nvar has = Object.prototype.hasOwnProperty\n  , prefix = '~';\n\n/**\n * Constructor to create a storage for our `EE` objects.\n * An `Events` instance is a plain object whose properties are event names.\n *\n * @constructor\n * @private\n */\nfunction Events() {}\n\n//\n// We try to not inherit from `Object.prototype`. In some engines creating an\n// instance in this way is faster than calling `Object.create(null)` directly.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// character to make sure that the built-in object properties are not\n// overridden or used as an attack vector.\n//\nif (Object.create) {\n  Events.prototype = Object.create(null);\n\n  //\n  // This hack is needed because the `__proto__` property is still inherited in\n  // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.\n  //\n  if (!new Events().__proto__) prefix = false;\n}\n\n/**\n * Representation of a single event listener.\n *\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} [once=false] Specify if the listener is a one-time listener.\n * @constructor\n * @private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Add a listener for a given event.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} once Specify if the listener is a one-time listener.\n * @returns {EventEmitter}\n * @private\n */\nfunction addListener(emitter, event, fn, context, once) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('The listener must be a function');\n  }\n\n  var listener = new EE(fn, context || emitter, once)\n    , evt = prefix ? prefix + event : event;\n\n  if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;\n  else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);\n  else emitter._events[evt] = [emitter._events[evt], listener];\n\n  return emitter;\n}\n\n/**\n * Clear event by name.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} evt The Event name.\n * @private\n */\nfunction clearEvent(emitter, evt) {\n  if (--emitter._eventsCount === 0) emitter._events = new Events();\n  else delete emitter._events[evt];\n}\n\n/**\n * Minimal `EventEmitter` interface that is molded against the Node.js\n * `EventEmitter` interface.\n *\n * @constructor\n * @public\n */\nfunction EventEmitter() {\n  this._events = new Events();\n  this._eventsCount = 0;\n}\n\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @public\n */\nEventEmitter.prototype.eventNames = function eventNames() {\n  var names = []\n    , events\n    , name;\n\n  if (this._eventsCount === 0) return names;\n\n  for (name in (events = this._events)) {\n    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    return names.concat(Object.getOwnPropertySymbols(events));\n  }\n\n  return names;\n};\n\n/**\n * Return the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Array} The registered listeners.\n * @public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  var evt = prefix ? prefix + event : event\n    , handlers = this._events[evt];\n\n  if (!handlers) return [];\n  if (handlers.fn) return [handlers.fn];\n\n  for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\n    ee[i] = handlers[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Return the number of listeners listening to a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Number} The number of listeners.\n * @public\n */\nEventEmitter.prototype.listenerCount = function listenerCount(event) {\n  var evt = prefix ? prefix + event : event\n    , listeners = this._events[evt];\n\n  if (!listeners) return 0;\n  if (listeners.fn) return 1;\n  return listeners.length;\n};\n\n/**\n * Calls each of the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Boolean} `true` if the event had listeners, else `false`.\n * @public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if (listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        case 4: listeners[i].fn.call(listeners[i].context, a1, a2, a3); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Add a listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  return addListener(this, event, fn, context, false);\n};\n\n/**\n * Add a one-time listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  return addListener(this, event, fn, context, true);\n};\n\n/**\n * Remove the listeners of a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn Only remove the listeners that match this function.\n * @param {*} context Only remove the listeners that have this context.\n * @param {Boolean} once Only remove one-time listeners.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return this;\n  if (!fn) {\n    clearEvent(this, evt);\n    return this;\n  }\n\n  var listeners = this._events[evt];\n\n  if (listeners.fn) {\n    if (\n      listeners.fn === fn &&\n      (!once || listeners.once) &&\n      (!context || listeners.context === context)\n    ) {\n      clearEvent(this, evt);\n    }\n  } else {\n    for (var i = 0, events = [], length = listeners.length; i < length; i++) {\n      if (\n        listeners[i].fn !== fn ||\n        (once && !listeners[i].once) ||\n        (context && listeners[i].context !== context)\n      ) {\n        events.push(listeners[i]);\n      }\n    }\n\n    //\n    // Reset the array, or remove it completely if we have no more listeners.\n    //\n    if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;\n    else clearEvent(this, evt);\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners, or those of the specified event.\n *\n * @param {(String|Symbol)} [event] The event name.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  var evt;\n\n  if (event) {\n    evt = prefix ? prefix + event : event;\n    if (this._events[evt]) clearEvent(this, evt);\n  } else {\n    this._events = new Events();\n    this._eventsCount = 0;\n  }\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Allow `EventEmitter` to be imported as module namespace.\n//\nEventEmitter.EventEmitter = EventEmitter;\n\n//\n// Expose the module.\n//\nif ('undefined' !== typeof module) {\n  module.exports = EventEmitter;\n}\n","import { EventEmitter } from 'eventemitter3'\nimport Network from './network'\nimport Peer from './peer'\nimport { SignalingPacketTypes } from './types'\n\ninterface SignalingListeners {\n  credentials: (data: SignalingPacketTypes) => void | Promise<void>\n}\n\nexport default class Signaling extends EventEmitter<SignalingListeners> {\n  private readonly url: string\n  private ws: WebSocket\n  private reconnectAttempt: number = 0\n  private reconnecting: boolean = false\n  receivedID?: string\n  receivedSecret?: string\n  currentLobby?: string\n  currentLobbyLeader?: string\n\n  private readonly connections: Map<string, Peer>\n\n  private readonly replayQueue: Map<string, SignalingPacketTypes[]>\n\n  private readonly requests: Map<string, RequestHandler> = new Map()\n\n  constructor (private readonly network: Network, peers: Map<string, Peer>, url: string) {\n    super()\n\n    this.url = url\n    this.connections = peers\n    this.replayQueue = new Map()\n\n    this.ws = this.connect()\n  }\n\n  private connect (): WebSocket {\n    const ws = new WebSocket(this.url)\n    const onOpen = (): void => {\n      this.reconnectAttempt = 0\n      this.reconnecting = false\n      this.send({\n        type: 'hello',\n        game: this.network.gameID,\n        id: this.receivedID,\n        secret: this.receivedSecret\n      })\n    }\n    const onError = (e: Event): void => {\n      const error = new SignalingError('socket-error', 'unexpected websocket error', e)\n      this.network._onSignalingError(error)\n      if (ws.readyState === WebSocket.CLOSED) {\n        this.reconnecting = false\n        ws.removeEventListener('open', onOpen)\n        ws.removeEventListener('error', onError)\n        ws.removeEventListener('message', onMessage)\n        ws.removeEventListener('close', onClose)\n        this.reconnect()\n      }\n    }\n    const onMessage = (ev: MessageEvent): void => {\n      this.handleSignalingMessage(ev.data).catch(_ => {})\n    }\n    const onClose = (): void => {\n      if (!this.network.closing) {\n        const error = new SignalingError('socket-error', 'signaling socket closed')\n        this.network._onSignalingError(error)\n      }\n      ws.removeEventListener('open', onOpen)\n      ws.removeEventListener('error', onError)\n      ws.removeEventListener('message', onMessage)\n      ws.removeEventListener('close', onClose)\n      this.reconnect()\n    }\n    ws.addEventListener('open', onOpen)\n    ws.addEventListener('error', onError)\n    ws.addEventListener('message', onMessage)\n    ws.addEventListener('close', onClose)\n    return ws\n  }\n\n  private reconnect (): void {\n    if (this.reconnecting || this.network.closing) {\n      return\n    }\n\n    this.close()\n\n    this.requests.forEach((r) => r.reject(new SignalingError('socket-error', 'signaling socket closed')))\n    this.requests.clear()\n\n    if (this.reconnectAttempt > 42) {\n      this.network.emit('failed')\n      this.network._onSignalingError(new SignalingError('socket-error', 'giving up on reconnecting to signaling server'))\n      return\n    }\n    void this.event('signaling', 'attempt-reconnect')\n    this.reconnecting = true\n    setTimeout(() => {\n      this.ws = this.connect()\n    }, Math.random() * 100 * this.reconnectAttempt)\n    this.reconnectAttempt += 1\n  }\n\n  close (): void {\n    this.ws.close()\n  }\n\n  async request (packet: SignalingPacketTypes): Promise<SignalingPacketTypes> {\n    return await new Promise<SignalingPacketTypes>((resolve, reject) => {\n      if (this.ws.readyState !== WebSocket.OPEN) {\n        reject(new SignalingError('socket-error', 'signaling socket not open'))\n      }\n      const rid = Math.random().toString(36).slice(2)\n      packet.rid = rid\n      this.network.log('requesting signaling packet:', packet.type)\n      const data = JSON.stringify(packet)\n      this.ws.send(data)\n      this.requests.set(rid, { resolve, reject })\n    })\n  }\n\n  send (packet: SignalingPacketTypes): void {\n    if (this.ws.readyState === WebSocket.OPEN) {\n      this.network.log('sending signaling packet:', packet.type)\n      const data = JSON.stringify(packet)\n      this.ws.send(data)\n    }\n  }\n\n  private async handleSignalingMessage (data: string): Promise<void> {\n    try {\n      const packet = JSON.parse(data) as SignalingPacketTypes\n      this.network.log('signaling packet received:', packet.type)\n      if (packet.rid !== undefined) {\n        const request = this.requests.get(packet.rid)\n        if (request != null) {\n          this.requests.delete(packet.rid)\n          if (packet.type === 'error') {\n            request.reject(new SignalingError('server-error', packet.message))\n          } else {\n            request.resolve(packet)\n          }\n        }\n      }\n      switch (packet.type) {\n        case 'error':\n          {\n            const error = new SignalingError('server-error', packet.message)\n            this.network._onSignalingError(error)\n            if (packet.code === 'missing-recipient' && packet.error?.recipient !== undefined) {\n              const id = packet.error?.recipient\n              if (this.connections.has(id)) {\n                this.network.log('cleaning up missing recipient', id)\n                this.connections.get(id)?.close('missing-recipient')\n              }\n            }\n          }\n          break\n\n        case 'welcome':\n          if (this.receivedID !== undefined) {\n            this.network.log('signaling reconnected')\n            this.network.emit('signalingreconnected')\n            return\n          }\n          if (packet.id === '') {\n            throw new Error('missing id on received welcome packet')\n          }\n          this.receivedID = packet.id\n          this.receivedSecret = packet.secret\n          this.network.emit('ready')\n          this.network._prefetchTURNCredentials()\n          break\n\n        case 'joined':\n          if (packet.lobby === '') {\n            throw new Error('missing lobby on received connect packet')\n          }\n          this.currentLobby = packet.lobby\n          this.currentLobbyLeader = packet.leader\n          this.network.emit('lobby', packet.lobby, packet.leader)\n          break\n\n        case 'connect':\n          if (this.receivedID === packet.id) {\n            return // Skip self\n          }\n          await this.network._addPeer(packet.id, packet.polite)\n          for (const p of this.replayQueue.get(packet.id) ?? []) {\n            await this.connections.get(packet.id)?._onSignalingMessage(p)\n          }\n          this.replayQueue.delete(packet.id)\n          break\n        case 'disconnect':\n          if (this.connections.has(packet.id)) {\n            this.connections.get(packet.id)?.close()\n          }\n          break\n\n        case 'candidate':\n        case 'description':\n          if (this.connections.has(packet.source)) {\n            await this.connections.get(packet.source)?._onSignalingMessage(packet)\n          } else {\n            const queue = this.replayQueue.get(packet.source) ?? []\n            queue.push(packet)\n            this.replayQueue.set(packet.source, queue)\n          }\n          break\n        case 'credentials':\n          this.emit('credentials', packet)\n          break\n        case 'ping':\n          break\n\n        case 'leader':\n          this.currentLobbyLeader = packet.id\n          this.network.emit('leader', packet.id)\n          break\n      }\n    } catch (e) {\n      const error = new SignalingError('unknown-error', e as string)\n      this.network._onSignalingError(error)\n    }\n  }\n\n  async event (category: string, action: string, data?: {[key: string]: string}): Promise<void> {\n    return await new Promise(resolve => {\n      setTimeout(() => {\n        this.send({\n          type: 'event',\n          game: this.network.gameID,\n          lobby: this.currentLobby,\n          peer: this.network.id,\n          category,\n          action,\n          data\n        })\n        resolve()\n      }, 0)\n    })\n  }\n}\n\ninterface RequestHandler {\n  resolve: (data: SignalingPacketTypes) => void\n  reject: (reason?: any) => void\n}\n\nexport class SignalingError {\n  /**\n   * @internal\n   */\n  constructor (public type: 'unknown-error' | 'socket-error' | 'server-error', public message: string, public event?: Event) {\n  }\n\n  public toString (): string {\n    return `[${this.type}: ${this.message}]`\n  }\n}\n","import Network from './network'\nimport Signaling, { SignalingError } from './signaling'\nimport Latency from './latency'\nimport { PeerConfiguration, SignalingPacketTypes } from './types'\n\nconst LatencyRestartIceThreshold = 1000 // ms\nconst ReconnectionWindow = 8000 // ms\n\nexport default class Peer {\n  public readonly conn: RTCPeerConnection\n\n  // Signaling state:\n  private makingOffer: boolean = false\n  private ignoreOffer: boolean = false\n  private isSettingRemoteAnswerPending: boolean = false\n\n  // Connection state:\n  private opened: boolean = false\n  private closing: boolean = false\n  private reconnecting: boolean = false\n  private abortReconnectionAt: number = 0\n  private allowNextManualRestartIceAt: number = 0\n\n  public latency: Latency = new Latency(this)\n  private lastMessageReceivedAt: number = 0\n\n  private politenessTimeout?: ReturnType<typeof setTimeout>\n  private reportLatencyEventTimeout?: ReturnType<typeof setTimeout>\n  private readonly checkStateInterval: ReturnType<typeof setInterval>\n  private readonly channels: {[name: string]: RTCDataChannel}\n\n  private readonly testSessionWrapper?: (desc: RTCSessionDescription, config: PeerConfiguration, selfID: string, otherID: string) => Promise<void>\n\n  /**\n   * @internal\n   */\n  constructor (private readonly network: Network, private readonly signaling: Signaling, public readonly id: string, public readonly config: PeerConfiguration, private readonly polite: boolean) {\n    this.channels = {}\n    this.network.log('creating peer')\n\n    this.testSessionWrapper = undefined\n\n    this.conn = new RTCPeerConnection(config)\n    if (config.testproxyURL === undefined) { // we dont push candidates in a test setup\n      this.conn.addEventListener('icecandidate', e => {\n        const candidate = e.candidate\n        if (candidate !== null) {\n          signaling.send({\n            type: 'candidate',\n            source: this.network.id,\n            recipient: this.id,\n            candidate\n          })\n        }\n      })\n    } else {\n      this.testSessionWrapper = wrapSessionDescription\n    }\n    this.conn.addEventListener('negotiationneeded', () => {\n      this.politenessTimeout = setTimeout(() => {\n        (async () => {\n          try {\n            if (this.closing) {\n              return\n            }\n            this.makingOffer = true\n            if (process.env.NODE_ENV === 'test') {\n              // Running tests with node and the wrtc package causes the\n              // setLocalDescription to fail with undefined as argment.\n              await this.conn.setLocalDescription(await this.conn.createOffer())\n            } else {\n              await this.conn.setLocalDescription()\n            }\n            const description = this.conn.localDescription\n            if (description != null) {\n              await this.testSessionWrapper?.(description, this.config, this.network.id, this.id)\n              this.signaling.send({\n                type: 'description',\n                source: this.network.id,\n                recipient: this.id,\n                description\n              })\n            }\n          } catch (e) {\n            const error = new SignalingError('unknown-error', e as string)\n            this.network._onSignalingError(error)\n          } finally {\n            this.makingOffer = false\n          }\n        })().catch(_ => {})\n      }, this.polite ? 100 : 0)\n    })\n\n    this.checkStateInterval = setInterval(() => {\n      this.checkState()\n    }, 500)\n    this.conn.addEventListener('signalingstatechange', () => this.checkState())\n    this.conn.addEventListener('connectionstatechange', () => this.checkState())\n    this.conn.addEventListener('iceconnectionstatechange', () => this.checkState())\n\n    this.network.emit('connecting', this)\n\n    let i = 0\n    for (const label in this.network.dataChannels) {\n      const chan = this.conn.createDataChannel(label, {\n        ...this.network.dataChannels[label],\n        id: i++,\n        negotiated: true\n      })\n      chan.binaryType = 'arraybuffer'\n      chan.addEventListener('error', e => this.onError(e))\n      chan.addEventListener('closing', () => this.checkState())\n      chan.addEventListener('close', () => this.checkState())\n      chan.addEventListener('open', () => {\n        if (!this.opened && !Object.values(this.channels).some(c => c.readyState !== 'open')) {\n          if ('control' in this.channels) {\n            this.latency = new Latency(this, this.channels.control)\n          }\n\n          if (this.politenessTimeout !== undefined) {\n            clearTimeout(this.politenessTimeout)\n          }\n\n          this.signaling.send({\n            type: 'connected',\n            id: this.id\n          })\n          this.opened = true\n          this.network.emit('connected', this)\n          void this.signaling.event('rtc', 'connected', { target: this.id })\n          this.reportLatencyEventTimeout = setTimeout(() => {\n            void this.signaling.event('rtc', 'avg-latency-at-10s', { target: this.id, latency: `${this.latency.average}` })\n          }, 10000)\n        }\n      })\n      chan.addEventListener('message', e => {\n        this.lastMessageReceivedAt = performance.now()\n        if (label !== 'control') {\n          this.network.emit('message', this, label, e.data)\n        }\n      })\n      this.channels[label] = chan\n    }\n  }\n\n  public close (reason?: string): void {\n    if (this.closing) {\n      return\n    }\n    this.closing = true\n\n    // Inform signaling server that the peer has been disconnected:\n    this.signaling.send({\n      type: 'disconnected',\n      id: this.id,\n      reason: reason ?? 'normal closure'\n    })\n\n    Object.values(this.channels).forEach(c => c.close())\n    this.conn.close()\n    this.network._removePeer(this)\n    if (this.checkStateInterval != null) {\n      clearInterval(this.checkStateInterval)\n    }\n    if (this.reportLatencyEventTimeout != null) {\n      clearTimeout(this.reportLatencyEventTimeout)\n    }\n\n    if (this.opened) {\n      this.network.emit('disconnected', this)\n      void this.signaling.event('rtc', 'disconnected', {\n        target: this.id,\n        reason: reason ?? '',\n        reconnecting: this.reconnecting ? 'true' : 'false'\n      })\n    }\n  }\n\n  private checkState (): void {\n    const now = performance.now()\n    const connectionState = this.conn.connectionState ?? this.conn.iceConnectionState\n    if (this.closing) {\n      return\n    }\n    if (!this.opened) {\n      if (connectionState === 'failed') {\n        this.close('connecting failed')\n      }\n      return\n    }\n    if (Object.values(this.channels).some(c => c.readyState !== 'open')) {\n      this.close('data channel closed')\n    }\n    // console.log('state', this.id, this.conn.connectionState, this.conn.iceConnectionState, Object.values(this.channels).map(c => c.readyState))\n    if (!this.reconnecting && (connectionState === 'disconnected' || connectionState === 'failed')) {\n      this.reconnecting = true\n      this.abortReconnectionAt = now + ReconnectionWindow\n      this.network.emit('reconnecting', this)\n      void this.signaling.event('rtc', 'attempt-reconnect', { target: this.id })\n    } else if (this.reconnecting && connectionState === 'connected') {\n      this.reconnecting = false\n      this.network.emit('reconnected', this)\n      void this.signaling.event('rtc', 'attempt-reconnected', { target: this.id })\n    } else if (this.reconnecting && now > this.abortReconnectionAt) {\n      this.close('reconnection timed out')\n    }\n    if (!this.reconnecting && 'control' in this.channels) {\n      const lastPing = this.lastMessageReceivedAt\n      if (lastPing !== 0) {\n        const delta = now - lastPing\n        if (delta > LatencyRestartIceThreshold && now > this.allowNextManualRestartIceAt) {\n          this.allowNextManualRestartIceAt = now + 10000\n          this.conn.restartIce()\n        }\n      }\n    }\n  }\n\n  private onError (e: Event): void {\n    this.network.emit('rtcerror', e)\n    if (this.network.listenerCount('rtcerror') === 0) {\n      console.error('rtcerror not handled:', e)\n    }\n    this.checkState()\n    void this.signaling.event('rtc', 'error', { target: this.id, error: JSON.stringify(e) })\n  }\n\n  /**\n   * @internal\n   */\n  async _onSignalingMessage (packet: SignalingPacketTypes): Promise<void> {\n    switch (packet.type) {\n      case 'candidate':\n        if (packet.candidate != null) {\n          try {\n            await this.conn.addIceCandidate(packet.candidate)\n          } catch (e) {\n            if (!this.ignoreOffer) {\n              throw e\n            }\n          }\n        }\n        break\n\n      case 'description':\n        {\n          const { description } = packet\n          const readyForOffer =\n            !this.makingOffer &&\n            (this.conn.signalingState === 'stable' || this.isSettingRemoteAnswerPending)\n          const offerCollision = description.type === 'offer' && !readyForOffer\n\n          this.ignoreOffer = !this.polite && offerCollision\n          if (this.ignoreOffer) {\n            return\n          }\n          this.isSettingRemoteAnswerPending = description.type === 'answer'\n          await this.conn.setRemoteDescription(description)\n          this.isSettingRemoteAnswerPending = false\n          if (description.type === 'offer') {\n            if (process.env.NODE_ENV === 'test') {\n              await this.conn.setLocalDescription(await this.conn.createAnswer())\n            } else {\n              await this.conn.setLocalDescription()\n            }\n            const description = this.conn.localDescription\n            if (description != null) {\n              await this.testSessionWrapper?.(description, this.config, this.network.id, this.id)\n              this.signaling.send({\n                type: 'description',\n                source: this.network.id,\n                recipient: this.id,\n                description\n              })\n            }\n          }\n        }\n        break\n    }\n  }\n\n  send (channel: string, data: string | Blob | ArrayBuffer | ArrayBufferView): void {\n    if (!(channel in this.channels)) {\n      throw new Error('unknown channel ' + channel)\n    }\n    const chan = this.channels[channel]\n    if (chan.readyState === 'open') {\n      chan.send(data as any)\n    }\n  }\n\n  toString (): string {\n    return `[Peer: ${this.id}]`\n  }\n}\n\nasync function wrapSessionDescription (desc: RTCSessionDescription, config: PeerConfiguration, selfID: string, otherID: string): Promise<void> {\n  if (config.testproxyURL === undefined) {\n    return\n  }\n\n  let lines = desc.sdp.split('\\r\\n')\n  lines = lines.filter(l => {\n    return !l.startsWith('a=candidate') || (l.includes('127.0.0.1') && l.includes('udp'))\n  })\n\n  for (let i = 0; i < lines.length; i++) {\n    const l = lines[i]\n    if (l.startsWith('a=candidate') && l.includes('127.0.0.1')) {\n      const orignalPort = l.split('127.0.0.1 ').pop()?.split(' ')[0] // find port\n      if (orignalPort != null) {\n        const resp = await fetch(`${config.testproxyURL}/create?id=${selfID + otherID}&port=${orignalPort}`)\n        const substitudePort = await resp.text()\n        lines[i] = l.replaceAll(` ${orignalPort} `, ` ${substitudePort} `)\n      }\n    }\n  }\n\n  ;(desc as any).sdp = lines.join('\\r\\n')\n}\n","import Peer from './peer'\n\nconst PingInterval = 500\nconst WindowSampleSize = 50\n\nconst PING = 'ping'\nconst PONG = 'pong'\n\nexport default class Latency {\n  private readonly window: number[] = []\n  private lastPingSentAt: number = 0\n\n  public last: number = 0\n  public average: number = 0\n  public jitter: number = 0\n  public max: number = 0\n  public min: number = 0\n\n  /**\n   * @internal\n   */\n  constructor (private readonly peer: Peer, private readonly control?: RTCDataChannel) {\n    if (control !== undefined) {\n      this.ping()\n\n      control.addEventListener('message', e => this.onMessage(e.data))\n    }\n  }\n\n  private ping (): void {\n    this.lastPingSentAt = performance.now()\n    if (this.control?.readyState === 'open') {\n      this.control?.send(PING)\n    }\n  }\n\n  private onMessage (data: string): void {\n    if (data === PING) {\n      if (this.control?.readyState === 'open') {\n        this.control?.send(PONG)\n      }\n      return\n    }\n    if (data !== PONG) {\n      return\n    }\n\n    const now = performance.now()\n    const delta = now - this.lastPingSentAt\n\n    this.window.unshift(delta)\n    if (this.window.length > WindowSampleSize) {\n      this.window.pop()\n    }\n\n    this.last = delta\n    this.max = Math.max(...this.window)\n    this.min = Math.min(...this.window)\n\n    this.average = this.window.reduce((a, b) => a + b, 0) / this.window.length\n\n    if (this.window.length > 1) {\n      this.jitter = this.window.slice(1).map((x, i) => Math.abs(x - this.window[i])).reduce((a, b) => a + b, 0) / (this.window.length - 1)\n    }\n\n    setTimeout(() => this.ping(), PingInterval - delta)\n  }\n}\n"],"names":[],"version":3,"file":"index.4b4806ae.js.map","sourceRoot":"/__parcel_source_root/"}